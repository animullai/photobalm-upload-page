<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8">
<title>Photobalm â€¢ upload</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.4/dist/tailwind.min.css" rel="stylesheet">
</head><body class="p-8">
<h1 class="text-3xl font-bold mb-6">Upload your photo</h1>

<input id="file" type="file" accept="image/*" class="mb-4">
<button id="go" class="px-4 py-2 rounded bg-emerald-600 hover:bg-emerald-700 text-white">
  Get a quote
</button>
<pre id="result" class="mt-6 whitespace-pre-wrap text-gray-800"></pre>

<script type="module">
const fileInp = document.querySelector('#file');
const goBtn   = document.querySelector('#go');
const result  = document.querySelector('#result');

/* your Worker root (same host handles both routes) */
const WORKER = 'https://photobalm-webhook.photobalm.workers.dev';
const DIRECT = WORKER + '/direct-upload';   // now points to Worker, not Images API
const CHAT   = WORKER;                      // POST for chat

goBtn.addEventListener('click', async () => {
  const file = fileInp.files[0];
  if (!file) { result.textContent = 'Please choose an image first.'; return; }

  try {
    // 1-time upload URL from Worker
    const upRes   = await fetch(DIRECT).then(r => r.json());
    const uploadU = upRes.uploadURL;

    // upload the file
    const fd  = new FormData(); fd.append('file', file);
    const imR = await fetch(uploadU, { method:'POST', body: fd }).then(r => r.json());
    const img = imR.result.variants[0];

    // chat
    const chat = await fetch(CHAT, {
      method:'POST',
      headers:{ 'Content-Type':'application/json' },
      body: JSON.stringify({ message:'', image_url: img })
    }).then(r => r.json());

    result.textContent = chat.reply;
  } catch (e) {
    console.error(e);
    result.textContent = 'Sorry, something went wrong. Please try again.';
  }
});
</script>
</body></html>
